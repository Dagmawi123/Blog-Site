<html> 
    <link rel="stylesheet" href="../CSS/style.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">
<!-- google fonts -->
<link href="https://fonts.googleapis.com/css2?family=Mooli&display=swap" rel="stylesheet"> 
    <body>
        <nav>
            <div class="container nav_container">
                <a href="/" class="nav_logo">BLOG</a>
                <ul class="nav_items">
                    <li> <a href='/blog'>Blog</a></li>
                    <li> <a href="about.html">About</a></li>
                    <li> <a href="services.html">Services</a></li>
                    <li> <a href="contact.html">Contact</a></li>
                    <!-- <li href="blog.html">Signin</li> -->
                    <li class ="nav_profile">
                        <div class="avatar">
                            <img src="./images/avatar1.jpg" alt="">
                        </div>
                        <ul>
                            <li><a href="dashboard.html">Dashboard</a></li>
                            <li><a href="logout.html">Logout</a></li>
                        </ul>
                    </li>
                </ul>
                <button id="open_nav-btn"><i class="uil uil-bars"></i></button>
                <button id="close_nav-btn"><i class="uil uil-multiply"></i></button>
            </div> 
        </nav>



<section class="form_section">
    <div class="container form_section-container">
<h2>Add User</h2>
<div class="alert_message error">
    <p id="err">This is an error message.</p>
</div>
<form id="addUser" action="" enctype="multipart/form-data">
    <input type="text" name="Fname" placeholder="First Name">
    <input type="text" name="Lname" placeholder="Last Name">
    <input type="text" name="Uname" placeholder="Username">
    <input type="email" name="Email" placeholder="Email">
    <input type="password" name="Password" placeholder="Create Password">
    <input type="password" name="Password_2" placeholder="Confirm Password">
    <select name="isAdmin" >
<option value="0">Author</option>
<option value="1">Admin</option>
    </select>
<div class="form_control">
    <label for="avatar">User Avatar</label>
<input type="file" name="Avatar" id="avatar">
</div>
<button type="submit" class="btn">Add User</button>

</form>
    </div>
</section>




<footer>
    <div class="footer_socials">
        <a href="https://youtube.com/realmadrid" target="_blank"><i class="uil uil-youtube"></i></a>
        <a href="https://facebook.com/realmadrid" target="_blank"><i class="uil uil-facebook"></i></a>
        <a href="https://instagram.com/realmadrid" target="_blank"><i class="uil uil-instagram"></i></a>
        <a href="https://linkedin.com/realmadrid" target="_blank"><i class="uil uil-linkedin"></i></a>
        <a href="https://twitter.com/realmadrid" target="_blank"><i class="uil uil-twitter"></i></a>

    </div>
    <div class="container footer_container">
<article>
    <h4>Categories</h4>
    <ul>
        <li><a href="">Art</a></li>
        <li><a href="">Wild Life </a></li>
        <li><a href="">Travel</a></li>
        <li><a href="">Music</a></li>
        <li><a href="">Science&Technology</a></li>
        <li><a href="">Food</a></li>
    </ul>
</article>
<article>
    <h4>Support</h4>
    <ul>
        <li><a href="">Online Support</a></li>
        <li><a href="">Call Numbers</a></li>
        <li><a href="">Emails</a></li>
        <li><a href="">Social Support</a></li>
        <li><a href="">Location</a></li>
    </ul>
</article>
<article>
    <h4>Blog</h4>
    <ul>
        <li><a href="">Safety</a></li>
        <li><a href="">Repair </a></li>
        <li><a href="">Recent</a></li>
        <li><a href="">Popular</a></li>
        <li><a href="">Categories</a></li>
    </ul>
</article>
<article>
    <h4>Permalinks</h4>
    <ul>
        <li><a href="">Home</a></li>
        <li><a href="">Blog</a></li>
        <li><a href="">Abou</a></li>
        <li><a href="">Services</a></li>
        <li><a href="">Contact</a></li>
        
    </ul>
</article>
    </div>
<div class="footer_copyright">
    <small>Copyright &copy;@2023 Realmadrid Football Club</small>
</div>
</footer>
<script>
    var userToken=''
    const pwd=document.querySelectorAll('input[type="password"]')[0]
    const pwd2=document.querySelectorAll('input[type="password"]')[1]
      const formEl=document.querySelector("#addUser")
    formEl.addEventListener('submit',(event)=>{ 
        event.preventDefault();
        if(pwd.value!=pwd2.value){
            document.querySelector('.alert_message').style.display='block'    
        document.querySelector('#err').textContent="Please type matching passwords"
        return
    }
   
    const formData=new FormData(formEl)
    const data=Object.fromEntries(formData)
    data.Avatar=data.Avatar.name
    if(!data.Avatar){
        delete data.Avatar
    }
    // console.log(data)
    if(data.isAdmin=="1")
    data.isAdmin=true
else  data.isAdmin=false

delete data.Password_2
fetch("/dashboard/add_user/save",{
method:'POST',
headers:{"Content-Type":'application/json'},
body:JSON.stringify(data)
}).then(response=>{console.log("Successful");
if(response.status==200){
    // alert("Wowza")
window.location.href='/dashboard'
// req.header('x-token')=res.header('x-token')//
// userToken=response.headers.get('x-token')
// var newForm=document.createElement('form')
// newForm.action='../'
// newForm.method='POST'
// var newInput=document.createElement('input')
// newInput.type='hidden'
// newInput.name='token'
// newInput.value=userToken
// newForm.appendChild(newInput)
// document.body.appendChild(newForm)

// newForm.submit()
}
else if(response.status==400) return response.text()
}).then(text=>{ 
document.querySelector('.alert_message').style.display='block'    
if(text)
document.querySelector('#err').textContent=text
else
document.querySelector('#err').textContent="User Added Successfully"
}).catch((reject)=>{
    console.log("Failure"+reject.message);
})
})
</script>
</body>
</html>